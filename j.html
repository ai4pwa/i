<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>File Loader</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    img { max-width: 100%; }
  </style>
</head>
<body>
  <div id="app">Loading...</div>

  <script>
    const page = new URLSearchParams(location.search).get("page");
    const app = document.getElementById("app");

    if (!page) {
      app.innerHTML = "<p>Missing <code>?page=</code> parameter.</p>";
      throw new Error("Missing ?page=");
    }

    const ext = page.split('.').pop().toLowerCase();
    const fileUrl = `https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/${page}`;

    const injectors = {
      html: () => {
        fetch(fileUrl)
          .then(r => r.text())
          .then(html => {
            document.open();
            document.write(html);
            document.close();
          });
      },
      css: () => {
        fetch(fileUrl)
          .then(r => r.text())
          .then(css => {
            const style = document.createElement("style");
            style.textContent = css;
            document.head.appendChild(style);
            app.innerHTML = "<p>CSS loaded and applied dynamically.</p>";
          });
      },
      js: () => {
        fetch(fileUrl)
          .then(r => r.text())
          .then(js => {
            const script = document.createElement("script");
            script.textContent = js;
            document.body.appendChild(script);
            app.innerHTML = "<p>JavaScript loaded and executed.</p>";
          });
      },
      png: () => renderImage(fileUrl),
      jpg: () => renderImage(fileUrl),
      jpeg: () => renderImage(fileUrl),
      gif: () => renderImage(fileUrl),
      svg: () => renderImage(fileUrl),
      webp: () => renderImage(fileUrl),
      default: () => {
        fetch(fileUrl)
          .then(r => r.text())
          .then(text => {
            app.innerHTML = `<pre style="white-space: pre-wrap;">${text}</pre>`;
          });
      }
    };

    function renderImage(url) {
      const img = document.createElement("img");
      img.src = url;
      app.innerHTML = "";
      app.appendChild(img);
    }

    (injectors[ext] || injectors.default)();
  </script>
</body>
</html>
